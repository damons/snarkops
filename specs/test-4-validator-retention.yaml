---
version: storage.snarkos.testing.monadic.us/v1

id: retention1m
name: minute long retention
description: |-
  A storage for testing retention policy generation and ledger rewinds
retention-policy: 10m:1m
generate: {}

---
version: nodes.snarkos.testing.monadic.us/v1
name: 4-validators

nodes:
  validator/test:
    replicas: 4
    key: committee.$
    height: 0
    validators: [validator/*]
    peers: []

---
version: timeline.snarkos.testing.monadic.us/v1

name: testing rewind twice
description: |-
  This timeline, when paired with a short retention policy, will test the
  following snarkops/snarkos features:

  - checkpoint creation
  - ledger rewind by block height
  - ledger rewind by time
  - validator sync

timeline:
  # wait 2 minutes for a checkpoint to be created
  - duration: 2m

  # change the height of the first two validators
  - config:
      validator/test-0:
        height: 0
      validator/test-1:
        height: 1m

  # wait 5 minutes for another few checkpoints to be created
  - duration: 5m

  # change the height of the last two validators
  - config:
      validator/test-2:
        height: 0
      validator/test-3:
        height: 5m

  # wait to see if the validators sync
  - duration: 1m
